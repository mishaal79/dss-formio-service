# =============================================================================
# DSS Form.io Service - Environment Template
# For local development and testing purposes only
# =============================================================================

# ‚ö†Ô∏è  SECURITY WARNING ‚ö†Ô∏è
# This template is for development use only
# Production deployments use Google Secret Manager exclusively
# Never commit real secrets to version control

# =============================================================================
# GOOGLE CLOUD CONFIGURATION
# =============================================================================

# Project and region settings
GOOGLE_CLOUD_PROJECT=erlich-dev
GOOGLE_CLOUD_REGION=australia-southeast1
GOOGLE_CLOUD_ZONE=australia-southeast1-a

# Terraform state encryption (optional but recommended)
# Generate with: openssl rand -base64 32
# GOOGLE_ENCRYPTION_KEY=your-base64-encryption-key-here

# =============================================================================
# TERRAFORM CONFIGURATION
# =============================================================================

# Environment-specific settings
TF_VAR_project_id=erlich-dev
TF_VAR_region=australia-southeast1
TF_VAR_environment=dev

# Service configuration
TF_VAR_service_name=dss-formio-api
TF_VAR_formio_root_email=admin@qrius.global

# Form.io versions
TF_VAR_formio_version=9.5.0
TF_VAR_community_version=v4.6.0-rc.3

# Form.io Enterprise license (from NOTES.md)
TF_VAR_formio_license_key=pOHMsV0uoOkfAS6q2jmugmr3Tm5VMt

# MongoDB configuration
TF_VAR_mongodb_version=7.0
TF_VAR_mongodb_machine_type=e2-small
TF_VAR_mongodb_data_disk_size=30
TF_VAR_mongodb_admin_username=mongoAdmin
TF_VAR_mongodb_formio_username=formioUser
TF_VAR_mongodb_database_name=formio
TF_VAR_mongodb_backup_retention_days=7

# =============================================================================
# DEPLOYMENT FLAGS
# =============================================================================

# Service deployment flags
TF_VAR_deploy_community=true
TF_VAR_deploy_enterprise=true
TF_VAR_portal_enabled=true

# Resource allocation (dev-optimized)
TF_VAR_max_instances=3
TF_VAR_min_instances=0
TF_VAR_cpu_request=1000m
TF_VAR_memory_request=2Gi
TF_VAR_concurrency=80
TF_VAR_timeout_seconds=300

# =============================================================================
# SENSITIVE CONFIGURATION - DO NOT SET IN PRODUCTION
# =============================================================================

# üîí These are automatically generated by Terraform in production
# üîí Only set these for local development/testing
# üîí Use `openssl rand -base64 32` to generate secure values

# Form.io secrets (leave empty to use Terraform-generated values)
# TF_VAR_formio_root_password=DevPassword123!
# TF_VAR_formio_jwt_secret=your-64-character-jwt-secret-here
# TF_VAR_formio_db_secret=your-64-character-db-secret-here

# MongoDB passwords (leave empty to use Terraform-generated values)
# TF_VAR_mongodb_admin_password=your-32-character-admin-password
# TF_VAR_mongodb_formio_password=your-32-character-formio-password

# =============================================================================
# USAGE INSTRUCTIONS
# =============================================================================

# 1. Copy this file to .env:
#    cp .env.template .env

# 2. Update project-specific values:
#    - GOOGLE_CLOUD_PROJECT
#    - TF_VAR_project_id
#    - TF_VAR_formio_root_email

# 3. (Optional) Set sensitive values for local testing
#    - Leave empty for production-grade Terraform-generated secrets

# 4. Load environment variables:
#    source .env

# 5. Deploy using automated script:
#    ./scripts/deploy.sh dev

# =============================================================================
# SECURITY BEST PRACTICES
# =============================================================================

# ‚úÖ DO use Google Secret Manager for production secrets
# ‚úÖ DO use Terraform random_password for cryptographic security
# ‚úÖ DO encrypt Terraform state with customer-managed keys
# ‚úÖ DO use least privilege IAM permissions
# ‚úÖ DO monitor secret access with Cloud Audit Logs

# ‚ùå DON'T commit .env files with real secrets
# ‚ùå DON'T use weak passwords in any environment
# ‚ùå DON'T store secrets in Terraform state
# ‚ùå DON'T hardcode credentials in application code
# ‚ùå DON'T share secrets via insecure channels

# =============================================================================
# TROUBLESHOOTING
# =============================================================================

# Common issues and solutions:

# 1. Permission denied errors:
#    - Ensure gcloud auth is configured: gcloud auth login
#    - Check project permissions: gcloud projects get-iam-policy PROJECT_ID

# 2. Terraform state lock issues:
#    - Check for stuck locks: terraform force-unlock LOCK_ID
#    - Verify backend bucket permissions

# 3. Secret Manager access denied:
#    - Verify IAM roles: roles/secretmanager.secretAccessor
#    - Check service account permissions

# 4. Cloud Run deployment failures:
#    - Review Cloud Run logs: gcloud logging read "resource.type=cloud_run_revision"
#    - Check service account key access

# For detailed troubleshooting, see: docs/runbooks/deployment-procedures.md